AWSTemplateFormatVersion: 2010-09-09

Description: Generated by rain

Resources:

  # Create an SES configuration set using the default ip pool
  MyConfigurationSet:
    Type: AWS::SES::ConfigurationSet
    Properties:
      Name: my-config-set
      DeliveryOptions:
        TlsPolicy: OPTIONAL
        SendingPoolName: ses-default-dedicated-pool 
      ReputationOptions:
        ReputationMetricsEnabled: true
      SendingOptions:
        SendingEnabled: true
      SuppressionOptions:
        SuppressedReasons:
          - COMPLAINT
      VdmOptions:
        DashboardOptions:
          EngagementMetrics: ENABLED
        GuardianOptions:
          OptimizedSharedDelivery: ENABLED

  # An SES configuration set event destination that sends events to cloudwatch
  MyConfigurationSetEventDestination:
    Type: AWS::SES::ConfigurationSetEventDestination
    Properties:
      EventDestination:
        Name: event-dest-1
        Enabled: true
        MatchingEventTypes:
          - reject
          - bounce
        CloudWatchDestination:
          DimensionConfigurations:
            - DefaultDimensionValue: example
              DimensionName: ses:from-domain
              DimensionValueSource: messageTag 
            - DimensionValueSource: messageTag
              DefaultDimensionValue: "0"
              DimensionName: ses:source-ip
      ConfigurationSetName: !Ref MyConfigurationSet

  # An SES contact list
  MyContactList:
    Type: AWS::SES::ContactList
    Properties:
      ContactListName: my-list
      Description: My contact list
      Topics:
        - TopicName: topic1
          DisplayName: Topic One
          DefaultSubscriptionStatus: OPT_IN
        - DefaultSubscriptionStatus: OPT_OUT
          TopicName: topic2
          DisplayName: Topic Two

  # An SES managed dedicated IP pool
  MyDedicatedIpPool:
    Type: AWS::SES::DedicatedIpPool
    Properties:
      ScalingMode: MANAGED

  # An SES email identity
  MyEmailIdentity:
    Type: AWS::SES::EmailIdentity
    Properties:
      EmailIdentity: example.com

  # An SES email identity for bounced emails
  MyBounceEmailIdentity:
    Type: AWS::SES::EmailIdentity
    Properties:
      EmailIdentity: bounce@example.com

  # An SES receipt filter to block an IP range
  MyReceiptFilter:
    Type: AWS::SES::ReceiptFilter
    Properties:
      Filter:
        IpFilter:
          Policy: Block
          Cidr: 10.0.0.1/24
        Name: BlockRange1

  # An SES receipt rule
  MyReceiptRule:
    Type: AWS::SES::ReceiptRule
    Properties:
      After: STRING
      Rule:
        Recipients:
          - user@example.com
        Actions:
          - AddHeaderAction:
              HeaderValue: X-Hello
              HeaderName: Hello
          - BounceAction:
              SmtpReplyCode: 550
              Message: Bounced
              StatusCode: 5.1.1
              Sender: !Ref MyBounceEmailIdentity
        Enabled: true
        Name: rule-1
        ScanEnabled: false
      RuleSetName: !Ref MyReceiptRuleSet

  # An SES receipt rule set
  MyReceiptRuleSet:
    Type: AWS::SES::ReceiptRuleSet
    Properties:
      RuleSetName: rule-set-1

  # An SES email template
  MyTemplate:
    Type: AWS::SES::Template
    Properties:
      Template:
        TemplateName: template-1
        SubjectPart: Hello
        TextPart: World
        HtmlPart: "<p>Hello</p>"

  # An SES Virtual Deliverability Manager configuration
  MyVdmAttributes:
    Type: AWS::SES::VdmAttributes
    Properties:
      DashboardAttributes:
        EngagementMetrics: ENABLED
      GuardianAttributes:
        OptimizedSharedDelivery: DISABLED

